# 电影创作流 - 三维导航可视化系统设计方案

## 设计理念

### 灵感来源：秘塔AI的思考路径可视化

秘塔AI在深度研究模式下的核心特点：
1. **实时展示思考过程** - 以思维导图形式动态生长
2. **多线迭代追溯** - 显示思考的分支和回溯路径
3. **神经元式生长** - 像大脑神经网络一样有机展开
4. **进度可视化** - 用户可实时跟踪AI推理到哪一步
5. **缩略图导航** - 提供全局视图和快速定位

### 我们的创新：三维创作流导航

在秘塔AI的基础上，我们增加了**三维导航系统**：

#### 第一维度：水平五阶段流程 (横向时间轴)
```
明确 → 聚焦 → 发散 → 收敛 → 整理
```
- 展示创作流程的时间推进
- 实时高亮当前所处阶段
- 显示已完成阶段的绿色标记

#### 第二维度：垂直三结构层级 (纵向深度轴)
```
第三结构 (意图层) ↕
第二结构 (隐喻层) ↕
第一结构 (故事层) ↕
```
- 展示思考的深度层次
- 标记当前激活的结构层
- 允许结构层级切换

#### 第三维度：思维导图网络 (思考空间)
```
用户输入 → 关键词 → 理论/作品/场景 → 引导问题
```
- 像秘塔AI一样动态生长
- 节点可点击查看详情
- 支持画布拖拽和缩放

## 核心界面布局

### 左侧：对话面板 (400px)
- **功能**: 保持传统对话交互
- **原因**: 用户熟悉的对话方式
- **内容**:
  - 会话信息 (ID, 轮次)
  - 历史对话记录
  - 输入框和发送按钮

### 右侧：可视化画布 (自适应)

#### 顶部：三维导航指示器
```
┌─────────────────────────────────────────────┐
│ 创作流程导航                                 │
├─────────────────────────────────────────────┤
│ [明确] → [聚焦] → [发散] → [收敛] → [整理]   │  ← 五阶段进度
├─────────────────────────────────────────────┤
│ [第三结构] [第二结构●] [第一结构]            │  ← 结构层级
└─────────────────────────────────────────────┘
```

#### 中部：思维导图画布
- **神经元式节点生长**
  - 用户输入 → 关键词节点
  - 关键词 → 理论/作品/场景节点
  - 理论/作品/场景 → 引导问题节点

- **节点颜色编码**
  - 💭 用户输入: 紫色 (#667eea)
  - 🔑 关键词: 绿色 (#10b981)
  - 📚 理论: 蓝色 (#3b82f6)
  - 🎬 作品: 紫罗兰 (#8b5cf6)
  - 🎥 场景: 橙色 (#f59e0b)
  - ❓ 引导问题: 红色 (#ef4444)

- **交互方式**
  - 点击节点 → 弹出详情面板
  - 拖拽画布 → 平移视图
  - 滚轮 → 缩放视图

#### 右下角：缩略图 (200x150px)
- 显示整个思维网络的全局视图
- 像秘塔AI一样提供快速定位

#### 右侧浮层：节点详情面板
- 点击节点后弹出
- 显示完整信息 (理论说明、场景画面、声音设计等)
- 可关闭返回画布

## 与秘塔AI的对比

| 特性 | 秘塔AI | 我们的系统 |
|------|--------|-----------|
| 思考路径可视化 | ✅ 思维导图动态生长 | ✅ 思维导图动态生长 |
| 进度追踪 | ✅ 显示推理进度 | ✅ 五阶段进度条 |
| 缩略图导航 | ✅ 右下角缩略图 | ✅ 右下角缩略图 |
| 结构深度 | ❌ 单一维度 | ✅ 三结构层级显示 |
| 对话保留 | ❌ 仅展示结果 | ✅ 左侧对话面板 |
| 节点详情 | ✅ 点击查看 | ✅ 浮层面板 |

## 解决的核心问题

### 问题1：用户不知道"我在哪里"
**秘塔AI的解决方案**: 思维导图显示推理路径
**我们的解决方案**:
- 五阶段进度条 → 知道流程位置
- 三结构指示器 → 知道思考深度
- 思维导图 → 知道思考网络

### 问题2：用户不知道"该往哪走"
**秘塔AI的解决方案**: 自动推理直到逻辑闭环
**我们的解决方案**:
- 引导问题节点 → 明确下一步方向
- 阶段高亮 → 知道下一阶段是什么
- 结构层级 → 可以切换思考层次

### 问题3：创作流不直观
**秘塔AI的启发**: 视觉化比文字描述更直观
**我们的实现**:
- 节点颜色 + 图标 → 快速识别内容类型
- 箭头连接 → 清晰的因果关系
- 动态生长 → 感知创作过程

## 技术实现

### 前端技术栈
- **HTML5 Canvas** - 高性能图形渲染
- **原生JavaScript** - 轻量级,无依赖
- **CSS3动画** - 流畅的交互效果

### 核心算法

#### 1. 自动布局算法 (树形布局)
```javascript
function calculateNodePosition(node, parentNode) {
    if (!parentNode) {
        // 根节点居中
        return { x: 100, y: 100 };
    } else {
        // 子节点向右下偏移
        const siblings = getSiblings(node);
        return {
            x: parentNode.x + 300,
            y: parentNode.y + siblings.length * 120
        };
    }
}
```

#### 2. 渐进式节点生成 (关键!)
```javascript
// 当前问题：Turn 1 生成所有内容
// 解决方案：基于turn_number控制生成

function processResponse(data, turnNumber) {
    if (turnNumber === 1) {
        // 仅显示关键词 + 引导问题
        addKeywordNodes(data.keywords);
        addQuestionNode(data.guiding_questions[0]);
    } else if (turnNumber === 2) {
        // 添加1-2个理论
        addTheoryNodes(data.theory_inspirations.slice(0, 2));
        addQuestionNode(data.guiding_questions[0]);
    } else if (turnNumber === 3) {
        // 添加2-3个作品
        addWorkNodes(data.work_inspirations.slice(0, 3));
        addQuestionNode(data.guiding_questions[0]);
    } else if (turnNumber >= 4) {
        // 逐个添加场景
        addSceneNode(data.visual_scenes[0]);
        addQuestionNode(data.guiding_questions[0]);
    }
}
```

#### 3. 阶段检测与导航更新
```javascript
function updateNavigation(stage, structure) {
    // 更新五阶段进度
    highlightStage(stage); // 'clarify', 'focus', 'diverge', 'converge', 'organize'

    // 更新三结构层级
    highlightStructure(structure); // 1, 2, 3
}
```

## 用户体验流程

### 场景：用户输入 "我想拍一部关于记忆的电影"

**Turn 1**: 明确阶段
```
[思维导图]
  💭 我想拍一部关于记忆的电影
    ↓
  🔑 记忆
  🔑 遗忘
  🔑 身份
    ↓
  ❓ 你想探讨记忆的哪个方面？遗忘的痛苦还是重建的希望？

[导航指示器]
阶段: [明确●] → [聚焦] → [发散] → [收敛] → [整理]
结构: [第三结构] [第二结构●] [第一结构]
```

**Turn 2**: 用户回答后,聚焦阶段
```
[思维导图]
  (上轮节点继续保留)
    ↓
  📚 《记忆碎片》- 克里斯托弗·诺兰的时间叙事
  📚 普鲁斯特的非自愿记忆理论
    ↓
  ❓ 这两个参考给你什么启发？

[导航指示器]
阶段: [明确✓] → [聚焦●] → [发散] → [收敛] → [整理]
结构: [第三结构] [第二结构●] [第一结构]
```

**Turn 3**: 发散阶段
```
[思维导图]
  (继续生长)
    ↓
  🎬 《记忆碎片》(诺兰)
  🎬 《她》(斯派克·琼斯)
  🎬 《攻壳机动队》(押井守)
    ↓
  ❓ 这些作品中,哪个的视觉风格更接近你的想象？

[导航指示器]
阶段: [明确✓] → [聚焦✓] → [发散●] → [收敛] → [整理]
结构: [第三结构] [第二结构●] [第一结构]
```

**Turn 4**: 收敛阶段 - 开始生成场景
```
[思维导图]
  (继续生长)
    ↓
  🎥 场景1: 碎片拼图
     (点击查看详情 → 画面/声音/时长/目的)
    ↓
  ❓ 这个场景的情感基调准确吗？需要调整吗？

[导航指示器]
阶段: [明确✓] → [聚焦✓] → [发散✓] → [收敛●] → [整理]
结构: [第三结构] [第二结构] [第一结构●]  (开始进入故事层)
```

## 下一步实现计划

### 阶段1: 前端可视化 ✅
- [x] 创建三维导航界面
- [x] 实现思维导图画布
- [x] 添加节点详情面板
- [x] 实现缩略图导航

### 阶段2: 后端渐进式生成 (需要实现)
- [ ] 修改 `/inspire` 端点的内容返回逻辑
- [ ] 实现基于 `turn_number` 的分阶段返回
- [ ] 确保引导问题真正被使用
- [ ] 添加阶段和结构层级的状态跟踪

### 阶段3: 触发机制 (高级功能)
- [ ] 停滞检测 (用户长时间不回复)
- [ ] 闲置激活 (主动提供新方向)
- [ ] 结构切换建议 (从意图层到故事层)

### 阶段4: 优化体验
- [ ] 动画效果优化
- [ ] 响应式布局
- [ ] 键盘快捷键
- [ ] 导出功能 (导出思维导图/对话记录)

## 设计哲学总结

### 秘塔AI教会我们的
1. **可视化思考过程** - 比结果本身更有价值
2. **实时反馈** - 让用户知道系统在思考
3. **空间隐喻** - 思维导图比线性文字更直观
4. **全局+局部** - 缩略图 + 详情面板

### 我们的独特价值
1. **三维导航** - 不仅是思考路径,还有流程阶段和思考深度
2. **渐进式协商** - 不是一次生成,而是逐步深化
3. **创作赋权** - 用户是创作者,不是选择者
4. **理论支撑** - 基于马尔可夫理论、认知共振、动态充分性

---

**核心目标**: 让用户清晰看到 **"我在创作流的哪个位置,该往哪个方向走"**

就像秘塔AI让用户看到 **"AI在思考路径的哪一步,要推理到哪里"** 一样。
