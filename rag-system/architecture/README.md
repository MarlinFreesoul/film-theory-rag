# RAG系统架构设计

## 系统架构图

```
┌─────────────────────────────────────────────────────────┐
│                      用户界面层                          │
│         (Streamlit / Gradio / Web Interface)            │
└───────────────────┬─────────────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────────────┐
│                   应用逻辑层                             │
│    - 查询理解  - 结果排序  - 答案生成  - 引用标注       │
└───────────────────┬─────────────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────────────┐
│                 RAG核心引擎                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │  检索模块    │  │  重排序模块  │  │  生成模块    │ │
│  │ (Retriever)  │  │  (Reranker)  │  │ (Generator)  │ │
│  └──────────────┘  └──────────────┘  └──────────────┘ │
└───────────────────┬─────────────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────────────┐
│                  向量数据库层                            │
│        Milvus / Pinecone / Qdrant / ChromaDB            │
└───────────────────┬─────────────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────────────┐
│                  知识库数据层                            │
│  - 电影理论文献  - 学术论文  - 教材章节  - 影评案例    │
└─────────────────────────────────────────────────────────┘
```

## 核心组件

### 1. 文档处理流水线

- **文本提取**：PDF、Markdown、HTML解析
- **文本分块**：语义分块、重叠窗口
- **元数据提取**：作者、年份、期刊、关键词
- **向量化**：嵌入模型生成向量表示

### 2. 检索策略

- **密集检索**：向量相似度检索
- **稀疏检索**：BM25关键词检索
- **混合检索**：密集+稀疏结合
- **知识图谱检索**：概念关系导航

### 3. 答案生成

- **提示工程**：学术风格提示模板
- **引用标注**：自动标注文献来源
- **多轮对话**：上下文记忆管理
- **格式化输出**：Markdown学术格式

## 技术选型

### 向量数据库
- **Milvus**: 大规模生产级
- **Qdrant**: 高性能、易部署
- **ChromaDB**: 轻量级、本地优先

### 嵌入模型
- **OpenAI Embeddings**: text-embedding-3-large
- **BGE**: BAAI/bge-large-zh-v1.5（中文）
- **M3E**: moka-ai/m3e-base（中文）

### 生成模型
- **GPT-4**: 最强理解与生成
- **Claude 3**: 长文本处理
- **文心一言**: 中文学术场景

## 开发计划

- [ ] 文档预处理脚本
- [ ] 向量数据库搭建
- [ ] 检索API开发
- [ ] Web界面开发
- [ ] 评估与优化

## 性能指标

- **检索准确率**: P@10 > 0.8
- **答案相关性**: 人工评分 > 4.0/5.0
- **引用准确性**: 100%
- **响应时间**: < 3秒
